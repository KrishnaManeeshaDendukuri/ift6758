---
layout: post
title: IFT6758 Project
---

(TODO: tiny Intro to NHL hockey) 

This page focuses on the discussions based on the problem statements mentioned in Milestone-1 of the Project for IFT 6758.

## 1. Warm-Up

There have been numerous attempts to define metrics that evaluate a goalies performance and one of the most used metric has been the Save Percentage(SV%). However, there are multiple factors that directly effect the performance, and hence should ideally be taken into account for this evaluation.

One of the problems with save percentage is that the quality of shots faced can vary a lot from goalie to goalie. For example, a goalie who plays for a weak defence may face harder shots than average. Adjusted measures of save percetage can help account for this. For example, even strengh save percentage can give a clearer picture of the goalie's performance by removing powerplay scoring, which is very volatile and dependant on the quality of the team's penalty kill. Other even strengh metrics allow us to go deeper into this type of analysis. One such metric is HDsc SV% (save percentage against high-danger scoring chances at even strengh).
Another problem is that SV% does not take worload into account. If two goalies play at the same level but play in a different number of games, the one who plays more has a bigger impact on his team's success. One metric that can help looking at a goalie's total contribution for a season is even strength xGA - even strengh GA. xGA is an estimate of expected GA based on shots faced by location against league average shooting% from those locations. For example, in the 2017-2018 season, Anti Raanta let in 74 even strengh goals and had an xGA of 84.9. So for that season, he let it 14.9 less even strengh goals than expected (see 'NHL advanced' section of https://www.hockey-reference.com/players/r/raantan01.html).

![Distribution of Top 20 Goalies wrt the SV%](/figures/save_percentage_plot.png "Distribution of Top 20 Goalies wrt the SV%")


## 2. Data Acquisition

This section is a short tutorial on downloading the play-by-play data from both the regular seasons and the playoffs, using the NHL API.

### API Endpoint

The primary endpoint we use to fetch this data is 

```markdown
---
https://statsapi.web.nhl.com/api/v1/game/[GAME_ID]/feed/live/
---
```
As we can see that the only argument the API inputs is the game_ID. This game_ID is a 10-digit identifier where the first 4 digits correspond to the season, next 2 digits indicate the type of the game where 02= regular season and 03=playoffs. The final 4 digits identify the specific game number. For playoff games, the 2nd digit of the specific number gives the round of the playoffs, the 3rd digit specifies the matchup, and the 4th digit specifies the game (out of 7).

### API Requests

We use python's requests library to fetch game data for a given Game ID.

```python
def get_file(game_id, folder_path):
    """
    Check if file is already downloaded.
        If yes, return the file path
        If not, check if it exists on the nhl api.
            If it does, save it locally and return the path
            If it doesn't, return None
    """
    
    file_path = folder_path + str(game_id) + '.json'
    if not os.path.isfile(file_path):
        data = requests.get(f'https://statsapi.web.nhl.com/api/v1/game/{game_id}/feed/live/')
        if (data.status_code == 404):
            return None
        with open(file_path, 'w') as f:
            json.dump(data.json(), f)
            
    return file_path
```
Notice, that we're sending the request only if a JSON for the corresponding game_ID has not already been fetched.

### Forming the Game IDs

For the regular season, the game ID has the following structue:

```python
game_id = int(f'{season}{game_type}{game_number.zfill(4)}')
```

While for the playoffs, the logic is

```python
game_id = int(f'{season}{game_type}{playoff_round.zfill(2)}{matchup}{game_number}')
# where the game_number is out of 7
```

#### Finally,
We then iterate over the game numbers to form game_IDs as required and fetch the live data using the API endpoint.
To enable analysis on this data and avoid redundant calls to the API, we dump the result into an individual JSON each time.


## Advanced Visualizations


{% include question_6_shotmap.html %}

### 6.2
#### Discuss what you can interpret from these plots.

These plots and shotmaps allow us to get a visual distribution of areas the teams shoots, which in turn aid the understanding the regions from which a team generates more or less than or equal to the league average rate of shots.
If observed over the seasons, the shotmaps can be very useful to understand the changing strategies of various teams. It also allows us to partly reason the standings of the teams.

### 6.3
#### Consider the Colorado Avalanche; take a look at their shot map during the 2016-17 season. Discuss what you could say about the team during this season. Now look at the shot map for the Colorado Avalanche for the 2020-21 season, and discuss what you could conclude from these differences. Does this make sense? Hint: look at the standings.

It is very evident from the standings that the performance had drastically improved between these two seasons.
From the shot map of Colorado Avalanche of 2016-17 season, we see that they have lesser shots than the league average in most of the areas and even lesser number of shots than league average from the area in front of the net, while it is the easiest to score from this area, in general. The areas where they have more shots than league average are near the boards and the blue line, which are the areas where it is usually harder to score from. This is indicative of a weak offensive team, which aligns with the fact that they finished last in the league that season.

On the Colorado Avalanche shot map of 2020-21 season, we see the absolute opposite! They have more shots than league average, especially in front of the net. As a result of which, they finished first in the league that season.

### 6.4
#### Consider the Buffalo Sabres, which have been a team that has struggled over recent years, and compare them to the Tampa Bay Lightning, a team which has won the Stanley for the past two years in a row. Look at the shot maps for these two teams from the 2018-19, 2019-20, and 2020-21 seasons. Discuss what observations you can make. Is there anything that could explain the Lightning’s success, or the Sabres’ struggles? How complete of a picture do you think this paints?

Based upon the shot maps and the play-by-play data, we can often analyze the regions that are slightly favourable for a good shot. In front of the net, is one such regions. But in most of these seasons, the Buffalo Sabres had less shots than league average from in front of the net, while the Tampa Bay Lightning had more shots than league average from in front of the net.
This can be one of the potential reasons for Lightning’s success and the Sabres’ struggles. 

Ofcourse,it is one of the many factors that effect the overall win of a team. Factors like goalie's performance, shot maps accompanied by the other play data such as the angle of the shot(which in turn help calculating the advanced metrics such as xG: Expected Goals); also help determine what helped or what did not work well for a team.
